### Android中图片占用内存问题

> 摘录链接：https://www.jianshu.com/p/3c5ac5fdb62a

#### Q1：一张 png 格式的图片，图片文件大小为 55.8KB，那么它加载进内存时所占的大小是多少？

#### Q2：为什么有时候，同一个 app，app 内的同个界面，界面上同张图片，但在不同设备上所耗内存却不一样？

#### Q3：同一张图片，在界面上显示的控件大小不同时，它的内存大小也会跟随着改变吗？

#### Q4：图片占用的内存大小公式：图片分辨率 \* 每个像素点大小，这种说法正确吗，或者严谨吗？

#### Q5：优化图片的内存大小有哪些方向可以着手？

### 总结

- 一张图片占用的内存大小的计算公式：分辨率 * 像素点大小；但分辨率不一定是原图的分辨率，需要结合一些场景来讨论，像素点大小就几种情况：ARGB_8888(4B)、RGB_565(2B) 等等。
- 如果不对图片进行优化处理，如压缩、裁剪之类的操作，那么 Android 系统会根据图片的不同来源决定是否需要对原图的分辨率进行转换后再加载进内存。
- 图片来源是 res 内的不同资源目录时，系统会根据设备当前的 dpi 值以及资源目录所对应的 dpi 值，做一次分辨率转换，规则如下：新分辨率 = 原图横向分辨率 * (设备的 dpi / 目录对应的 dpi ) * 原图纵向分辨率 * (设备的 dpi / 目录对应的 dpi )。
- 其他图片的来源，如磁盘，文件，流等，均按照原图的分辨率来进行计算图片的内存大小。
- jpg、png 只是图片的容器，图片文件本身的大小与它所占用的内存大小没有什么关系，当然它们的压缩算法并不一样，在解码时所耗的内存与效率此时就会有些区别。
- 基于以上理论，以下场景的出现是合理的：
- 同个 app，在不同 dpi 设备中，同个界面的相同图片所占的内存大小有可能不一样。
- 同个 app，同一张图片，但图片放于不同的 res 内的资源目录里时，所占的内存大小有可能不一样。
- 以上场景之所说有可能，是因为，一旦使用某个热门的图片开源库，那么，以上理论基本就不适用了。
- 因为系统支持对图片进行优化处理，允许先将图片压缩，降低分辨率后再加载进内存，以达到降低占用内存大小的目的
- 而热门的开源图片库，内部基本都会有一些图片的优化处理操作：
- 当使用 fresco 时，不管图片来源是哪里，即使是 res，图片占用的内存大小仍旧以原图的分辨率计算。
- 当使用 Glide 时，如果有设置图片显示的控件，那么会自动按照控件的大小，降低图片的分辨率加载。图片来源是 res 的分辨率转换规则对它也无效。