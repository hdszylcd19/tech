## Android为什么需要屏幕适配

由于Android系统的开放性，任何用户、开发者、OEM厂商、运营商都可以对Android进行定制，修改成他们想要的样子。

但是这种“碎片化”到底到达什么程度呢？

在2012年，OpenSignalMaps（以下简称OSM）发布了第一份Android碎片化报告，统计数据表明，

- 2012年，支持Android的设备共有3997种。
- 2013年，支持Android的设备共有11868种。
- 2014年，支持Android的设备共有18796种。

下面这张图片所显示的内容足以充分说明当今Android系统碎片化问题的严重性，因为该图片中的每一个矩形都代表着一种Android设备。

![android碎片化](.\imgs\android碎片化.png)

详细的统计数据可以看 [这里](https://opensignal.com/reports/2014/android-fragmentation/)。

而随着支持Android系统的设备(手机、平板、电视、手表)的增多，设备碎片化、品牌碎片化、系统碎片化、传感器碎片化和屏幕碎片化的程度也在不断地加深。而我们今天要探讨的，则是对我们开发影响比较大的——屏幕的碎片化。

下面这张图是Android屏幕尺寸的示意图，在这张图里面，蓝色矩形的大小代表不同尺寸，颜色深浅则代表所占百分比的大小。

![android屏幕碎片化](.\imgs\android屏幕碎片化.png)

**那么，屏幕适配的目的就是为了让应用程序在不同的分辨率下有较好的显示效果。**

## 一、基本概念

什么是屏幕尺寸、屏幕分辨率、屏幕像素密度？  什么是dp、dip、dpi、sp、px？他们之间的关系是什么？  什么是mdpi、hdpi、xdpi、xxdpi？如何计算和区分？ 

### 1.1 屏幕尺寸

屏幕尺寸指屏幕的对角线的长度，单位是英寸，1英寸=2.54厘米

比如常见的屏幕尺寸有2.4、2.8、3.5、3.7、4.2、5.0、5.5、6.0等等

### 1.2 屏幕分辨率

屏幕分辨率是指在横纵向上的像素点数，单位是px，1px=1个像素点。一般以纵向像素*横向像素来表示，如`1960 x 1080`。 

### 1.3 屏幕像素密度(dpi)

屏幕像素密度是指每英寸上的像素点数，单位是dpi，即“dot per inch”的缩写。

- **屏幕像素密度与屏幕尺寸和屏幕分辨率有关；**
- **在分辨率相同时，屏幕尺寸越小，像素密度越大，手机屏幕则越清晰。** 

### 1.4 dp、dip、sp、px

px我们应该是比较熟悉的，前面的分辨率就是用的像素为单位，大多数情况下，比如UI设计、Android原生API都会以px作为统一的计量单位，像是获取屏幕宽高等。

dip和dp是一个意思，都是“Density Independent Pixels（密度无关像素）”的缩写，即密度无关像素，上面我们说过，dpi是屏幕像素密度，假如一英寸里面有160个像素，这个屏幕的像素密度就是160dpi，那么在这种情况下，dp和px如何换算呢？在Android中，规定以160dpi为基准，1dip=1px，如果密度是320dpi，则1dip=2px，以此类推。

假如同样都是画一条320px的线，在`480 x 800`分辨率手机上显示为2/3屏幕宽度，在`320 x 480`的手机上则占满了全屏，如果使用dp为单位，在这两种分辨率下，160dp都显示为屏幕一半的长度。这也是为什么在Android开发中，写布局的时候要尽量使用dp而不是px的原因。

而sp，即“scale-independent pixels（比例无关像素）”，与dp类似，但是可以根据文字大小首选项进行放缩，是设置字体大小的御用单位。

### 1.5 mdpi、hdpi、xdpi、xxdpi、xxxdpi

其实之前还有个ldpi，但是随着移动设备配置的不断升级，这个像素密度的设备已经很罕见了，所在现在适配时不需考虑。

mdpi、hdpi、xdpi、xxdpi用来修饰Android中的drawable文件夹及values文件夹，用来区分不同像素密度下的图片和dimen值。

那么如何区分呢？Google官方指定按照下列标准进行区分：

| 名称    | 像素密度范围  |
| ------- | ------------- |
| ldpi    | <120dpi       |
| mdpi    | 120dpi~160dpi |
| hdpi    | 160dpi~240dpi |
| xhdpi   | 240dpi~320dpi |
| xxhdpi  | 320dpi~480dpi |
| xxxhdpi | 480dpi~640dpi |

在进行开发的时候，我们需要把合适大小的图片放在合适的文件夹里面。下面以图标设计为例进行介绍。

在设计图标时，对于五种主流的像素密度（MDPI、HDPI、XHDPI、XXHDPI 和 XXXHDPI）应按照 `2:3:4:6:8` 的比例进行缩放。如下图所示：

![scale_seed](.\imgs\scale_seed.png)

例如，一个启动图标的尺寸为48x48 dp，这表示在 MDPI 的屏幕上其实际尺寸应为 48x48 px，在 HDPI 的屏幕上其实际大小是 MDPI 的 1.5 倍 (72x72 px)，在 XDPI 的屏幕上其实际大小是 MDPI 的 2 倍 (96x96 px)，依此类推。

虽然 Android 也支持低像素密度 (LDPI) 的屏幕，但无需为此费神，系统会自动将 HDPI 尺寸的图标缩小到 1/2 进行匹配。

下图为图标的各个屏幕密度的对应的图片尺寸：

| 屏幕密度 | 图标尺寸  |
| -------- | --------- |
| mdpi     | 48x48px   |
| hdpi     | 72x72px   |
| xhdpi    | 96x96px   |
| xxhdpi   | 144x144px |
| xxxhdpi  | 192x192px |

## 二、适配方案

### 2.1 图片适配

根据手机的像素密度去选择对应的文件夹下（drawable、mipmap）的图片 

#### 2.1.1 图片加载规则

- 根据手机的像素密度 mdpi ,选择 对应文件夹下的图片  drawable-mdpi
- 根据手机的像素密度 mdpi ,向上查找 --hdpi --xhdpi , 如果向上查找不到,只能向下查找 -- ldpi

#### 2.1.2 图片加载顺序

- **ldpi -- mdpi - 默认文件夹(drawable/values/layout/mipmap) - hdpi -- xhdpi --xxhdpi** 

### 2.2 dimens适配

根据手机的像素密度去选择对应的values文件夹下dimens资源

### 2.3 布局适配

根据手机的像素密度去选择对应的layout文件下的资源，可以创建不同屏幕密度的文件夹，如：layout-hdpi / mdpi / xhdpi 等；也可以创建特定分辨率的文件夹，如：layout-1280x720  (小写字母:x)等。

**谷歌推荐使用；但是实际开发中，一般不采用布局适配，工作量太大！！！**

### 2.4 代码适配

通过代码动态指定控件宽高

### 2.5 权重适配

weight,巧妙利用权重等分屏幕